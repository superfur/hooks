"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[596],{2e3:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>d,toc:()=>c});var i=s(4848),t=s(8453);const l={sidebar_position:6},o="useWindowCommunication",d={id:"hooks/useWindowCommunication",title:"useWindowCommunication",description:"\u7528\u4e8e\u5728\u4e0d\u540c\u6d4f\u89c8\u5668\u7a97\u53e3/\u6807\u7b7e\u9875\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u7684 Hook\u3002",source:"@site/docs/hooks/useWindowCommunication.md",sourceDirName:"hooks",slug:"/hooks/useWindowCommunication",permalink:"/hooks/en/hooks/useWindowCommunication",draft:!1,unlisted:!1,editUrl:"https://github.com/superfur/hooks/edit/main/website/docs/hooks/useWindowCommunication.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"hooksSidebar",previous:{title:"useDocumentTitle",permalink:"/hooks/en/hooks/useDocumentTitle"}},a={},c=[{value:"\u4ecb\u7ecd",id:"\u4ecb\u7ecd",level:2},{value:"\u7279\u6027",id:"\u7279\u6027",level:2},{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5",level:2},{value:"React",id:"react",level:3},{value:"Vue",id:"vue",level:3},{value:"Solid",id:"solid",level:3},{value:"API",id:"api",level:2},{value:"\u53c2\u6570",id:"\u53c2\u6570",level:3},{value:"\u8fd4\u56de\u503c",id:"\u8fd4\u56de\u503c",level:3},{value:"React",id:"react-1",level:4},{value:"Vue",id:"vue-1",level:4},{value:"Solid",id:"solid-1",level:4},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:2},{value:"\u57fa\u7840\u7528\u6cd5\uff08React\uff09",id:"\u57fa\u7840\u7528\u6cd5react",level:3},{value:"\u57fa\u7840\u7528\u6cd5\uff08Vue\uff09",id:"\u57fa\u7840\u7528\u6cd5vue",level:3},{value:"\u57fa\u7840\u7528\u6cd5\uff08Solid\uff09",id:"\u57fa\u7840\u7528\u6cd5solid",level:3},{value:"\u6d4f\u89c8\u5668\u517c\u5bb9\u6027",id:"\u6d4f\u89c8\u5668\u517c\u5bb9\u6027",level:2}];function r(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"usewindowcommunication",children:"useWindowCommunication"}),"\n",(0,i.jsx)(e.p,{children:"\u7528\u4e8e\u5728\u4e0d\u540c\u6d4f\u89c8\u5668\u7a97\u53e3/\u6807\u7b7e\u9875\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u7684 Hook\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"\u4ecb\u7ecd",children:"\u4ecb\u7ecd"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"useWindowCommunication"})," \u63d0\u4f9b\u4e86\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u4e0d\u540c\u6d4f\u89c8\u5668\u7a97\u53e3\u6216\u6807\u7b7e\u9875\u4e4b\u95f4\u7684\u901a\u4fe1\u3002\u5b83\u4f18\u5148\u4f7f\u7528\u73b0\u4ee3\u7684 ",(0,i.jsx)(e.code,{children:"BroadcastChannel"})," API\uff0c\u5982\u679c\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\uff0c\u5219\u56de\u9000\u5230\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"localStorage"})," \u4e8b\u4ef6\u3002"]}),"\n",(0,i.jsx)(e.h2,{id:"\u7279\u6027",children:"\u7279\u6027"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u652f\u6301\u8de8\u7a97\u53e3/\u6807\u7b7e\u9875\u901a\u4fe1"}),"\n",(0,i.jsxs)(e.li,{children:["\u81ea\u52a8\u5728 ",(0,i.jsx)(e.code,{children:"BroadcastChannel"})," \u548c ",(0,i.jsx)(e.code,{children:"localStorage"})," \u4e4b\u95f4\u5207\u6362"]}),"\n",(0,i.jsx)(e.li,{children:"\u4fdd\u5b58\u6d88\u606f\u5386\u53f2"}),"\n",(0,i.jsx)(e.li,{children:"\u63d0\u4f9b\u6700\u65b0\u6d88\u606f\u548c\u6d88\u606f\u5386\u53f2\u8bb0\u5f55"}),"\n",(0,i.jsx)(e.li,{children:"\u652f\u6301 React\u3001Vue 3 \u548c Solid"}),"\n",(0,i.jsx)(e.li,{children:"TypeScript \u652f\u6301"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u4f7f\u7528\u65b9\u6cd5",children:"\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,i.jsx)(e.h3,{id:"react",children:"React"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",children:"import { useWindowCommunication } from '@septem/hooks/react';\n\nfunction ChatWindow() {\n  const [state, postMessage] = useWindowCommunication('chat-channel');\n  const { lastMessage, messages } = state;\n\n  const sendMessage = () => {\n    postMessage({\n      text: 'Hello from window 1!',\n      timestamp: Date.now()\n    });\n  };\n\n  return (\n    <div>\n      <button onClick={sendMessage}>\u53d1\u9001\u6d88\u606f</button>\n      <div>\n        <h3>\u6700\u65b0\u6d88\u606f\uff1a</h3>\n        {lastMessage && <pre>{JSON.stringify(lastMessage, null, 2)}</pre>}\n      </div>\n      <div>\n        <h3>\u6d88\u606f\u5386\u53f2\uff1a</h3>\n        <ul>\n          {messages.map((msg, index) => (\n            <li key={index}>{JSON.stringify(msg)}</li>\n          ))}\n        </ul>\n      </div>\n    </div>\n  );\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"vue",children:"Vue"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-vue",children:'<script setup lang="ts">\nimport { useWindowCommunication } from \'@septem/hooks/vue\';\n\nconst { state, postMessage } = useWindowCommunication(\'chat-channel\');\n\nconst sendMessage = () => {\n  postMessage({\n    text: \'Hello from window 1!\',\n    timestamp: Date.now()\n  });\n};\n<\/script>\n\n<template>\n  <div>\n    <button @click="sendMessage">\u53d1\u9001\u6d88\u606f</button>\n    <div>\n      <h3>\u6700\u65b0\u6d88\u606f\uff1a</h3>\n      <pre v-if="state.lastMessage">{{ JSON.stringify(state.lastMessage, null, 2) }}</pre>\n    </div>\n    <div>\n      <h3>\u6d88\u606f\u5386\u53f2\uff1a</h3>\n      <ul>\n        <li v-for="(msg, index) in state.messages" :key="index">\n          {{ JSON.stringify(msg) }}\n        </li>\n      </ul>\n    </div>\n  </div>\n</template>\n'})}),"\n",(0,i.jsx)(e.h3,{id:"solid",children:"Solid"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",children:"import { useWindowCommunication } from '@septem/hooks/solid';\n\nfunction ChatWindow() {\n  const [state, postMessage] = useWindowCommunication('chat-channel');\n\n  const sendMessage = () => {\n    postMessage({\n      text: 'Hello from window 1!',\n      timestamp: Date.now()\n    });\n  };\n\n  return (\n    <div>\n      <button onClick={sendMessage}>\u53d1\u9001\u6d88\u606f</button>\n      <div>\n        <h3>\u6700\u65b0\u6d88\u606f\uff1a</h3>\n        {state().lastMessage && <pre>{JSON.stringify(state().lastMessage, null, 2)}</pre>}\n      </div>\n      <div>\n        <h3>\u6d88\u606f\u5386\u53f2\uff1a</h3>\n        <ul>\n          {state().messages.map((msg, index) => (\n            <li key={index}>{JSON.stringify(msg)}</li>\n          ))}\n        </ul>\n      </div>\n    </div>\n  );\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"api",children:"API"}),"\n",(0,i.jsx)(e.h3,{id:"\u53c2\u6570",children:"\u53c2\u6570"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u53c2\u6570"}),(0,i.jsx)(e.th,{children:"\u8bf4\u660e"}),(0,i.jsx)(e.th,{children:"\u7c7b\u578b"}),(0,i.jsx)(e.th,{children:"\u5fc5\u586b"})]})}),(0,i.jsx)(e.tbody,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"channelName"}),(0,i.jsx)(e.td,{children:"\u901a\u4fe1\u9891\u9053\u540d\u79f0"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"string"})}),(0,i.jsx)(e.td,{children:"\u662f"})]})})]}),"\n",(0,i.jsx)(e.h3,{id:"\u8fd4\u56de\u503c",children:"\u8fd4\u56de\u503c"}),"\n",(0,i.jsx)(e.h4,{id:"react-1",children:"React"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"[\n  {\n    lastMessage: any;    // \u6700\u65b0\u63a5\u6536\u5230\u7684\u6d88\u606f\n    messages: any[];     // \u6d88\u606f\u5386\u53f2\u8bb0\u5f55\n  },\n  (message: any) => void // \u53d1\u9001\u6d88\u606f\u7684\u51fd\u6570\n]\n"})}),"\n",(0,i.jsx)(e.h4,{id:"vue-1",children:"Vue"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"{\n  state: Ref<{\n    lastMessage: any;    // \u6700\u65b0\u63a5\u6536\u5230\u7684\u6d88\u606f\n    messages: any[];     // \u6d88\u606f\u5386\u53f2\u8bb0\u5f55\n  }>,\n  postMessage: (message: any) => void // \u53d1\u9001\u6d88\u606f\u7684\u51fd\u6570\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"solid-1",children:"Solid"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"[\n  () => ({\n    lastMessage: any;    // \u6700\u65b0\u63a5\u6536\u5230\u7684\u6d88\u606f\n    messages: any[];     // \u6d88\u606f\u5386\u53f2\u8bb0\u5f55\n  }),\n  (message: any) => void // \u53d1\u9001\u6d88\u606f\u7684\u51fd\u6570\n]\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5728\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"localStorage"})," \u6a21\u5f0f\u65f6\uff0c\u6d88\u606f\u5927\u5c0f\u53d7\u9650\u4e8e ",(0,i.jsx)(e.code,{children:"localStorage"})," \u7684\u5bb9\u91cf\u9650\u5236\uff08\u901a\u5e38\u4e3a 5-10MB\uff09\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c\u6d4f\u89c8\u5668\u652f\u6301 ",(0,i.jsx)(e.code,{children:"BroadcastChannel"})," API\uff0c\u5c06\u4f18\u5148\u4f7f\u7528\u5b83\uff0c\u56e0\u4e3a\u5b83\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u6027\u80fd\u548c\u53ef\u9760\u6027\u3002"]}),"\n",(0,i.jsx)(e.li,{children:"\u6d88\u606f\u5fc5\u987b\u662f\u53ef\u4ee5\u88ab JSON \u5e8f\u5217\u5316\u7684\u6570\u636e\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u5728\u7ec4\u4ef6\u5378\u8f7d\u65f6\uff0c\u4f1a\u81ea\u52a8\u6e05\u7406\u901a\u4fe1\u901a\u9053\u548c\u4e8b\u4ef6\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsxs)(e.li,{children:["\u4e0d\u540c\u6846\u67b6\u7248\u672c\u7684\u8fd4\u56de\u503c\u683c\u5f0f\u7565\u6709\u4e0d\u540c\uff0c\u8bf7\u6ce8\u610f\u4f7f\u7528\u6b63\u786e\u7684\u65b9\u5f0f\u8bbf\u95ee\u72b6\u6001\uff1a","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"React\uff1a\u76f4\u63a5\u8bbf\u95ee state \u5bf9\u8c61"}),"\n",(0,i.jsx)(e.li,{children:"Vue\uff1a\u901a\u8fc7 state.value \u8bbf\u95ee"}),"\n",(0,i.jsx)(e.li,{children:"Solid\uff1a\u901a\u8fc7 state() \u51fd\u6570\u8c03\u7528\u8bbf\u95ee"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,i.jsx)(e.h3,{id:"\u57fa\u7840\u7528\u6cd5react",children:"\u57fa\u7840\u7528\u6cd5\uff08React\uff09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",children:"import { useWindowCommunication } from '@septem/hooks/react';\n\nfunction WindowA() {\n  const [state, postMessage] = useWindowCommunication('my-channel');\n\n  return (\n    <button onClick={() => postMessage('Hello from Window A')}>\n      \u53d1\u9001\u6d88\u606f\n    </button>\n  );\n}\n\nfunction WindowB() {\n  const [{ lastMessage }] = useWindowCommunication('my-channel');\n\n  return (\n    <div>\n      \u6536\u5230\u7684\u6d88\u606f: {lastMessage}\n    </div>\n  );\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u57fa\u7840\u7528\u6cd5vue",children:"\u57fa\u7840\u7528\u6cd5\uff08Vue\uff09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-vue",children:"<script setup lang=\"ts\">\nimport { useWindowCommunication } from '@septem/hooks/vue';\n\n// \u53d1\u9001\u65b9\nconst { postMessage } = useWindowCommunication('my-channel');\n\n// \u63a5\u6536\u65b9\nconst { state } = useWindowCommunication('my-channel');\n<\/script>\n\n<template>\n  <button @click=\"() => postMessage('Hello from Window A')\">\n    \u53d1\u9001\u6d88\u606f\n  </button>\n  <div>\n    \u6536\u5230\u7684\u6d88\u606f: {{ state.lastMessage }}\n  </div>\n</template>\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u57fa\u7840\u7528\u6cd5solid",children:"\u57fa\u7840\u7528\u6cd5\uff08Solid\uff09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",children:"import { useWindowCommunication } from '@septem/hooks/solid';\n\nfunction WindowA() {\n  const [state, postMessage] = useWindowCommunication('my-channel');\n\n  return (\n    <button onClick={() => postMessage('Hello from Window A')}>\n      \u53d1\u9001\u6d88\u606f\n    </button>\n  );\n}\n\nfunction WindowB() {\n  const [state] = useWindowCommunication('my-channel');\n\n  return (\n    <div>\n      \u6536\u5230\u7684\u6d88\u606f: {state().lastMessage}\n    </div>\n  );\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6d4f\u89c8\u5668\u517c\u5bb9\u6027",children:"\u6d4f\u89c8\u5668\u517c\u5bb9\u6027"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"BroadcastChannel"})," API\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Chrome 54+"}),"\n",(0,i.jsx)(e.li,{children:"Firefox 38+"}),"\n",(0,i.jsx)(e.li,{children:"Edge 79+"}),"\n",(0,i.jsx)(e.li,{children:"Safari 15.4+"}),"\n",(0,i.jsx)(e.li,{children:"Opera 41+"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"localStorage"})," \u56de\u9000\u65b9\u6848\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"IE 8+"}),"\n",(0,i.jsx)(e.li,{children:"\u6240\u6709\u73b0\u4ee3\u6d4f\u89c8\u5668"}),"\n"]}),"\n"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(r,{...n})}):r(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>o,x:()=>d});var i=s(6540);const t={},l=i.createContext(t);function o(n){const e=i.useContext(l);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:o(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);